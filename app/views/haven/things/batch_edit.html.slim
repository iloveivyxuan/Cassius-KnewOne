hgroup
  h1
    | 批量修改产品

- queries = params.except(*request.path_parameters.keys)
- queries[:filter] ||= []

ul.nav.nav-pills
  - if queries[:filter].any?
    li
      = link_to '全部', queries.reject! {|k, v| k == :filter}
  - else
    li.active
      = link_to '全部', queries.reject! {|k, v| k == :filter}

  - {'no_link' => '无购买链接',
     'no_category' => '无分类',
     'no_price' => '无价格',
     'concept' => '研发中',
     'kick' => '众筹中',
     'pre_order' => '预售',
     'domestic' => '国内导购',
     'abroad' => '国外海淘',
     'dsell' => '自销',
     'feelings_count' => '按短评数排序',
     'reviews_count' => '按评测数排序',
     'heat' => '按热度排序',
     'priority_asc' => '优先度倒序',
     'priority_desc' => '优先度正序'}.each do |k, v|

     - conds = queries.deep_dup
     - if conds[:filter].include?(k)
       li.active
         - conds[:filter].reject! {|f| f == k}
         = link_to v, batch_edit_haven_things_path(conds)
     - else
       li
         - conds[:filter].push(k)
         = link_to v, batch_edit_haven_things_path(conds)

= form_tag batch_update_haven_things_path(redirect_from: request.fullpath), method: :patch do
  table.table.table-striped.table-hover.table-bordered
    tr
      th style="width:40%" 标题
      th 购买
      th style="width:15%" 分类
      th style="width:10%"
    - @things.each do |t|
      tr
        td
          = hidden_field_tag 'things[][id]', t.id.to_s
          | 标题
          = text_field_tag 'things[][title]', t.title, style: 'width: 100%'
          br
          | 副标题
          = text_field_tag 'things[][subtitle]', t.subtitle, style: 'width: 100%'
          br
          | 价格单位
          = select_tag 'things[][price_unit]', options_for_select(["¥", "$", "€", "£", "JPY¥", "₩"], t.price_unit)
          br
          | 价格
          = text_field_tag 'things[][price]', t.price, style: 'width: 100%'
          br
          | 优先级
          = text_field_tag 'things[][priority]', t.priority, style: 'width: 100%'
        td
          | 阶段
          = select_tag 'things[][stage]', options_for_select(Thing::STAGES.invert, t.stage), style: 'width: 100%'
          | 购买链接
          = text_field_tag 'things[][shop]', t.shop, style: 'width: 100%'
        td= text_field_tag 'things[][categories_text]', t.categories_text, hint: "用,分隔", style: 'width: 100%'
        td
          = link_to t, target: '_blank' do
            = image_tag(t.cover.url(:small))
          end

  = submit_tag '修改', class: 'btn btn-primary'

= paginate @things
